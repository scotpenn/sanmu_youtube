<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>“三木有话说”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #F0F8FF;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        .flow-step {
            position: relative;
            padding-left: 2.5rem;
            padding-bottom: 2rem;
        }
        .flow-step:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 1.125rem;
            top: 1.5rem;
            width: 2px;
            height: 100%;
            background-color: #4682B4;
            opacity: 0.3;
        }
        .flow-dot {
            position: absolute;
            left: 0.5rem;
            top: 0.5rem;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 9999px;
            background-color: #4682B4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-gray-700">

    <div id="content-container" class="container mx-auto p-4 md:p-8 max-w-4xl opacity-0 transition-opacity duration-500">
        <!-- Content will be dynamically inserted here -->
    </div>

    <script>
        // Function to dynamically load a script
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error(`Script load error for ${src}`));
                document.head.appendChild(script);
            });
        }

        // Function to render the chart
        function renderChart(canvasId, chartData) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, chartData);
        }

        // Main function to build the page
        async function buildPage() {
            const params = new URLSearchParams(window.location.search);
            const topicId = params.get('topic');

            if (!topicId) {
                document.getElementById('content-container').innerHTML = `<h1 class="text-center text-2xl font-bold text-red-500">错误：未指定文章主题。</h1>`;
                document.getElementById('content-container').classList.remove('opacity-0');
                return;
            }

            try {
                // Load the specific article's data
                await loadScript(`articles/${topicId}.js`);
                
                // The data is now available in the global `articleData` variable
                const data = window.articleData;

                // Set the page title
                document.title = data.title;

                // Build the HTML content from the data
                const contentContainer = document.getElementById('content-container');
                let html = `
                    <header class="text-center py-8 md:py-12">
                        <h1 class="text-4xl md:text-5xl font-bold" style="color: #4682B4;">${data.header.title}</h1>
                        <p class="mt-4 text-lg md:text-xl text-gray-600">${data.header.subtitle}</p>
                    </header>
                `;

                data.sections.forEach(section => {
                    html += `
                        <section class="mb-12 md:mb-20">
                            ${section.title ? `<h2 class="text-2xl md:text-3xl font-bold text-center mb-8" style="color: #4682B4;">${section.title}</h2>` : ''}
                            <div class="bg-white p-8 rounded-lg shadow-lg">
                                ${section.content}
                            </div>
                        </section>
                    `;
                });

                html += `
                    <footer class="text-center py-8 border-t border-gray-200">
                        <p class="text-xl font-semibold" style="color: #4682B4;">${data.footer.title}</p>
                        <p class="mt-4 max-w-2xl mx-auto text-gray-600">${data.footer.text}</p>
                    </footer>
                `;
                
                contentContainer.innerHTML = html;
                contentContainer.classList.remove('opacity-0');

                // If there's a chart, render it
                if (data.chart) {
                    renderChart(data.chart.canvasId, data.chart.chartConfig);
                }

            } catch (error) {
                console.error(error);
                document.getElementById('content-container').innerHTML = `<h1 class="text-center text-2xl font-bold text-red-500">错误：无法加载文章内容。</h1>`;
                document.getElementById('content-container').classList.remove('opacity-0');
            }
        }

        document.addEventListener('DOMContentLoaded', buildPage);
    </script>
</body>
</html>
